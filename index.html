<!DOCTYPE html>
<html>

    <head>
        <link rel="stylesheet"
            href="https://fonts.googleapis.com/icon?family=Material+Icons">
        <link rel="stylesheet"
            href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
        <script defer
            src="https://code.getmdl.io/1.3.0/material.min.js"></script>
        <script
            src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@3.2.0/dist/tf.min.js">
            </script>

        <meta name="viewport" content="width=device-width, initial-scale=1.0">
    </head>

    <body>
        <p></p>
        <div style="margin: auto; width: 50%; padding: 3px;">
            <div style="width: 90%">
                <div class="mdl-textfield mdl-js-textfield">
                    <input class="mdl-textfield__input" type="text"
                        id="datetimeString" onfocusout="compute()">
                    <label class="mdl-textfield__label"
                        for="datetimeString">Enter
                        Datetime String</label>
                </div>
            </div>
        </div>
        <script>
            const datetimeForm = document.getElementById('datetimeForm');
            const model_weights_address = "https://raw.githubusercontent.com/mdturp/python-datetime-string-guessing/main/model_weights/model.json"
            const vocabulary_address = "https://raw.githubusercontent.com/mdturp/python-datetime-string-guessing/main/model_weights/vocabulary.json"
            const OUTPUT_SEQUENCE_LENGTH = 250

            function tokenize_input(x, vocabulary) {
  
                const x_array = Array.from(x);
                var output = []
                for (var i = 0; i < OUTPUT_SEQUENCE_LENGTH; i++){
                    var token = 0;
                    if (i < x_array.length) {
                        token = vocabulary.indexOf(x_array[i])
                        if (token === -1) {
                            token = 1
                        }
                    }
                    output.push(token)
                }
                return output
            }

            async function prediction() {
               
               
                
                console.log(vocabulary)
            }

            async function compute() {
                var x = document.getElementById("datetimeString");
                const string_value = x.value;
                const vocabulary_response = await fetch(vocabulary_address);
                const vocabulary = await vocabulary_response.json();
                const tokenized_word = tokenize_input(string_value, vocabulary);
                const broadcasted = tf.broadcastTo(tokenized_word, [1, OUTPUT_SEQUENCE_LENGTH])
                const model = await tf.loadLayersModel(model_weights_address);
                const prediction = await model.predict(broadcasted);
                const prediction_arr = Array.from(prediction.squeeze().dataSync());

                console.log(prediction_arr)
            }
            // datetimeForm.addEventListener('submit', "Hey Submitted");

        </script>
    </body>

</html>
